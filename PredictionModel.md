# 预测模型

孙启轩 

* *模型的原理*
* 模型适用范围
* 模型的求解和检验

***

## 广义的预测模型：对事物状态和发展趋势的预测

* 时空状态的预测：元胞自动机   (交通状况，谣言传播)
* 简单状态的预测：分类器   (肿瘤预测)
* 数值的预测

1. 元胞自动机 ：交通状况的仿真

   车辆行驶规则：黑色元胞表示被一辆车占据，白色元胞代表无车。若前方格子有车，则停止；若前方格子没有车，则前进一格。 

   ![traffic](/image/traffic.jpg)

   + 演化规则：加速，减速
   + 不只是一维的

2. 分类器：肿瘤的诊断
   影响因素一维：
   ![pre_1](/image/pre_1.jpg)
   影响因素二维：
   ![pre_2](/image/pre_2.jpg)
   有监督：分类器；无监督：聚类
***

## 数值的预测

* 插值，拟合
* 灰色模型
* 时间序列模型
* 数据预处理
***

## 插值，拟合

### 插值

问题：知道函数 $$ y=f(x) $$ 在$ n $个互异的点$$ x_1, x_2, …, x_n $$的函数值 $$y_1, y_2, …, y_n $$. 如何估计此函数在另一点$$a$$ 的函数值？ 

* 插值方法要求近似函数经过所有已知点
* 插值方法不一定能得到近似函数的表达形式
* 插值常用于补上少量缺失数据，可以用于数据预处理

#### 插值方法调用
```matlab
yi = interp1(x,y,xi,method)
```

|参数|含义|参数|含义|
|:---|:---|:---|:---|
|x|原始数据横坐标|y|原始数据纵坐标|
|xi|插值点横坐标|yi|插值点纵坐标|
|x,y|一维向量|xi|单值或向量|
|method|插值方法|

插值方法：
|插值方法|具体内容|
|:---|:---|
|nearest|临近插值（近似直角）|
|linear|线性插值|
|cubic|立方插值|
|pchip|分段三次Hermite插值|
|spline|类似pchip|

#### 数据作图：
1. 先得到预测向量再作图
```matlab
x = [];
y = [];
xi = [];
yi = interp1(x,y,xi,method)
plot(x,y,'ro',xi,yi)
```
2. 先作图再得到预测值
curve fitting tool  + 数据游标

#### 例子：1900-2010每10年产量

|年份| 1900 | 1910 |1920|1930|1940|1950|
| ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 产量 | 75.995 | 91.972  | 105.711  | 123.203  |131.669  |150.697  |
|年份| 1960 | 1970 |1980|1990|2000|2010|
| 产量  |179.323|	203.212|226.505|249.633|256.344|267.893|

```matlab
%原始数据导入
syms x y;
x = 1900:10:2010;
y = [75.995	91.972	105.711	123.203	131.669	150.697	179.323	203.212	226.505	249.633	256.344	267.893];

%插值预测数据
x0 = 1900:2050;
y0_nearest = interp1(x,y,x0,'nearest');
y0_linear = interp1(x,y,x0,'linear');
y0_pchip = interp1(x,y,x0,'pchip');

%作图
plot(x,y,'ro'); hold on;
plot(x0,y0_nearest,'b-');hold on;
plot(x0,y0_linear,'k-'); hold on;
plot(x0,y0_pchip,'y-'); hold on;
xlabel('年份');
ylabel('年产量');
legend('原始数据','nearest插值','linear插值','pchip插值');
grid on;
```

### 拟合
问题：已知n个数据点$$（x_i, y_i) ，i=1,2,…,n$$，$$x_i$$互不相同，寻求函数 $$y=f(x)$$，使$$f(x)$$在某种准则下（如$$LMS$$（least mean square））与这$$n$$个点最接近。

* 有干扰点，数据准确率不高，数据量较大
* 与插值不同的是，不必要求近似函数的曲线或曲面通过所有数据点

#### 常用的拟合方法
+ 直线拟合：用一次函数或称线性函数拟合数据.
+ 曲线拟合：若直线拟合效果不佳，可提高拟合精度，用曲线拟合数据. 常用的是二次函数、三次函数等高次多项式，有时也会用到指数函数、对数函数、三角函数等.
+ 分段拟合：在不同段上用不同的低次多项式进行拟合.

**注意：多项式拟合不是次数越高越好**

#### 调用方法
+ regress（）和polyfit（）适用于线性函数的拟合
+ lsqcurvefit（）和nlinfit（）适用于较复杂的非线性函数的拟合
```matlab
func_sin = @(a,t) a(1) * sin(a(4) * t + a(2)) + a(3);
A= lsqcurvefit(func_sin, [46.25 -1.628 7.23 0.2551], x, y);
```
+  fit（）适用于最常用函数的拟合，如指数函数，傅立叶函数、高斯函数、多项式函数、幂函数、有理函数等等。
+ curve fitting tool

#### 例子：房价预测

![salesprice](/image/salesprice.jpg)

#### 例子：长江水质监测
|年份|1995|1996|1997|1998|1999|
| ----| ----| ----| ----| ----| ----|
|排放量/亿吨|174|179|183|189|207|
|年份|2000|2001|2002|2003|2004|
|排放量/亿吨|234|220.5|256|270|285|
```matlab
%原始数据导入
syms x y;
x = [1995	1996	1997	1998	1999	2000	2001	2002	2003	2004];
y = [174 179 183 189 207 234 220.5 256 270 285];
x0 = 1995:2020;

%多项式拟合系数
p1 = polyfit(x,y,1);
p2 = polyfit(x,y,2);
p3 = polyfit(x,y,3);

%预测值
y1 = polyval(p1,x0);
y2 = polyval(p2,x0);
y3 = polyval(p3,x0);

%作图
plot(x,y,'r*'); hold on;
plot(x0,y1,'b-'); hold on;
plot(x0,y2,'g-'); hold on;
plot(x0,y3,'k-'); hold on;
xlabel('年份'); ylabel('污水量/亿吨');
legend('实际污水排放量','一次曲线预测污水排放量','二次曲线预测污水排放量','三次曲线预测污水排放量');
title('长江污水排放量增长曲线');
grid on;
```
***warning?***
**Equation is badly conditioned. Remove repeated data points or try centering and scaling.**

这只是警告，不是错误。出现这一警告的一般是因为数据在横坐标方向上跨度太大，在这种跨度很大的多项式拟合里，为了提高拟合精度，通常希望让横坐标变得更加集中，因为在一个相对狭窄的小区间上去拟合，要比在一个相对很宽的区间上拟合更容易，且能提高拟合精度。**Matlab推荐的做法是： centering and scaling transformation，即以横坐标的均值为中心、以横坐标的标准差来做归一化因子，将数据变得相对集中。**
```matlab
x1 = (x - mean(x)) / std(x)
```

### 简单的数据预处理
数据的标准化（normalization）是将数据按照一定规则缩放，使之落入一个小的特定区间。这样去除数据的单位限制，将其转化为无量纲的纯数值，便于不同单位或量级的指标能够进行比较和加权。
+ Min - Max标准化 (Min-Max normalization)
也称离差标准化，是对原始数据的线性变换，使结果落到[0,1]区间内。
$$
y_i = \dfrac{x_i - \min_{1 \leq  j \leq n}\{x_j\}}{\max_{1 \leq j \leq n}\{x_j\} - \min_{1 \leq j \leq n}\{x_j\}}
$$
+ Z - score 标准化 (zero-mean normalization)
	准差标准化，经过处理的数据符合标准正态分布，即均值为0，标准差为1

$$
y_i = \dfrac{x_i - \bar{x}}{s}
$$
$$
\bar{x} = \dfrac{1}{n}\sum_{i = 1}^{n} x_i
$$
$$
s = \sqrt{\dfrac{1}{n-1} \sum_{i = 1}^{n} (x_i - \bar{x})^2 }
$$

### 灰色模型
+ 灰色预测是一种预测*灰色系统*的方法。     
+ 大致过程：对规律性较差的原始数据生成有较强规律性的数据序列，然后建立相应的微分方程模型，从而预测事物未来的发展趋势。
+ 灰色预测认为一切灰色**序列**都能通过某种生成弱化其随机性，显现其规律性。
+ 微分方程建立的基础是生成数据模型而不是原始数据模型。 数据生成的常用方式有累加生成、累减生成和加权累加生成。

#### 数据预处理：生成数据
* 常用方法：累加生成，累减生成，加权累加生成
* （一次）累加生成：
$$
原始数列为: x^{(0)} = \left(x^{(0)}(1),x^{(0)}(2),...,x^{(0)}(n)\right)
$$
$$
令: x^{(1)}(k) = \sum_{i = 1}^{k} x^{(0)}(i)   , k = 1,2,...,n
$$
$$
得到: x^{(1)} = \left( x^{(1)}(1),x^{(1)}(2),...,x^{(1)}(n)   \right)
$$
* （一次）累减生成：
$$
原始数列为: x^{(1)} = \left(x^{(1)}(1),x^{(1)}(2),...,x^{(1)}(n)\right)
$$
$$
令: x^{(0)}(k) = x^{(1)}(k) - x^{(1)}(k - 1)   , k = 1,2,...,n
$$

#### GM(1,1)的模型
原始数据的起伏转变为生成数列的递增

原始数据：

![pic2](/image/pic2.jpg)

一次累加数据：

![pic1](/image/pic1.jpg)

##### GM(1,1)的定义

定义： $$ x^{(1)}  $$ 的灰导数为
$$
d(k) = x^{(0)}(k) = x^{(1)}(k) - x^{(1)}(k - 1)
$$
设$$ z^{(1)} (k)$$为$$x^{(1)}$$临值生成数列
$$
z^{(1)}(k) = \alpha x^{(1)}(k) + (1 - \alpha)x^{(1)}(k - 1)
$$
通常取 $$ \alpha = 0.5 $$构造临值生成，$$ \alpha $$取其他值时成为加权临值生成
于是定义GM(1,1)的灰微分方程为：
$$
d(k) + az^{(1)}(k) = b \quad 或\quad  x^{(0)}(k) + az^{(1)}(k) = b
$$
a称为发展系数，b称为灰作用量

将$$ k = 2,3,...,n$$代入上式得到
$$
\left\{
\begin{aligned}
&x^{(0)}(2) + az^{(1)}(2) = b\\
&x^{(0)}(3) + az^{(1)}(3) = b\\
&...\\
&x^{(0)}(n) + az^{(1)}(n) = b\\
\end{aligned}
\right.
$$
引入矩阵向量记号
$$
u = 
\left[
\begin{aligned}
a\\
b\\
\end{aligned}
\right]

Y = 
\left[
\begin{aligned}
&x^{(0)}(2)\\
&x^{(0)}(3)\\
&...\\
&x^{(0)}(n)\\
\end{aligned}
\right]

B =
\left[
\begin{aligned}
&-z^{(1)}(2) \quad 1\\
&-z^{(1)}(3) \quad 1\\
&... \\
&-z^{(1)}(n) \quad 1\\
\end{aligned}
\right]
$$

于是GM(1,1)模型记为  $$Y = Bu$$
用最小二乘法求解$$a,b$$的值
$$
u = 
\left[
\begin{aligned}
a\\
b\\
\end{aligned}
\right]
 = 
 \left( B^T B \right)^{-1} B^T Y
$$

将 $$u $$ 代入灰微分方程得到解：
$$
x^{(1)}(t) = \left(  x^{(0)}(1) - \dfrac{b}{a} \right)e^{-a(t - 1)} + \dfrac{b}{a}
$$

最后通过累减数列将预测得到的生成数列的值转变为原始数列
$$
x^{(0)}(k) = x^{(1)}(k) - x^{(1)}(k - 1)   , k = 1,2,...,n
$$

##### GM(1,1)的白化型

对于GM(1,1)的灰微分方程，如果将$$x^{(0)}(k)$$的时刻$$= 2,3,...,n$$连续连续的变量$$t$$，则数列$$x^{(1)} $$就可以视作时间$$t$$的函数，记为$$x^{(1)} = x^{(1)}(t)$$，并让灰导数$$x^{(0)}$$对应于导数$$\dfrac{dx^{(1)}}{dt}$$，于是得到GM(1,1)的灰微分方程对应的白微分方程为：
$$
\dfrac{dx^{(1)}}{dt} + ax^{(1)} = b
$$
#### 灰色预测的步骤

* 数据的检验和处理
计算原始数列的级比
$$
\lambda (k) = \dfrac{x^{(0)}(k-1)}{x^{(0)}(k)}, k = 2,3,...,n
$$
如果所有的级比都落在可容覆盖区间  $$ X = ( e^{\dfrac{-2}{n + 1}},e^{ \dfrac{2}{n + 1}} ) $$内，则数列$$ x^{(0)} $$可以建立GM(1,1)模型且可以进行灰色预测。否则，对数据做适当的变换处理，如平移变换：
$$
y^{(0)}(k) = x^{(0)}(k) + c ,k = 1,2,...,n
$$
*  建立GM(1,1)模型，求解a和b
代入并累减得到预测数列
$$
x^{(1)}(t) = \left( x^{(0)}(1) - \dfrac{b}{a} \right) e^{-a(t - 1)} + \dfrac{b}{a}
$$
*  残差检验
$$
\varepsilon (k) = \dfrac{x^{(0)}(k) - {\hat{x}}^{(0)}(k) }{x^{(0)}(k)}, k = 1,2,...,n
$$
所有 $$ |\varepsilon (k)| < 0.1  $$较好；所有 $$ |\varepsilon (k)| < 0.2  $$一般


#### 例子：噪声预测
北方某城市 1986～1992 年道路交通噪声平均声级数据如表所示
|年份|$$ L_{eq} $$|年份|$$ L_{eq} $$|
|---|---|---|---|
|1986|71.1|1990|71.4|
|1987|72.4|1991|72.0|
|1988|72.4|1992|71.6|
|1989|72.1|||
######  第一步：级比检验
建立交通噪声平均声级数据时间序列如下：
$$
\begin{aligned}
x^{(0)} & = \left( x^{(0)}(1),x^{(0)}(2),...,x^{(0)}(n)  \right)\\
& = (71.1，	72.4，	72.4，	72.1，	71.4，	72，	71.6)\\
\end{aligned}
$$
*   求级比 $$ \lambda(k) $$
$$
\lambda (k) = \dfrac{x^{(0)}(k-1)}{x^{(0)}(k)}
$$
$$
\begin{aligned}
\lambda & = (\lambda(2),\lambda(3),...,\lambda(7))\\
& = (0.982,1,1.0042,1.0098,0.9917,1.0056)
\end{aligned}
$$
*   级比判断
由于所有的$$  \lambda (k) \in (0.779,1.284) , k = 2,3,...,7 $$，故可以用作GM(1,1)建模
###### 第二步：GM(1,1)建模
* 对原始数列$$ x^{(0)} $$作一次累加，即
$$
x^{(1)} = (71.1,143.5,215.9,288,359.4,431.4,503)
$$
*  构造数据矩阵$$B$$及数据向量$$Y$$
$$
Y = 
\left[
\begin{aligned}
&x^{(0)}(2)\\
&x^{(0)}(3)\\
&...\\
&x^{(0)}(7)\\
\end{aligned}
\right]

B =
\left[
\begin{aligned}
&-\dfrac{1}{2}\left( x^{(0)}(1) + x^{(0)}(2) \right) \quad 1\\
&-\dfrac{1}{2}\left( x^{(0)}(2) + x^{(0)}(3) \right) \quad 1\\
&... \\
&-\dfrac{1}{2}\left( x^{(0)}(6) + x^{(0)}(7) \right) \quad 1\\
\end{aligned}
\right]
$$
*  计算$$ \hat{u}$$
$$
\hat{u} = (a,b)^T = (B^TB)^{-1}B^TY = 
\left(
\begin{aligned}
0.0012\\
72.6573\\
\end{aligned}
\right)
$$
于是得到
$$
a = 0.0023,b = 72.6573
$$
*  建立模型
$$
\dfrac{dx^{(1)}}{dt} + 0.0023x^{(1)} = 72.6573
$$
求解得到
$$
x^{(1)}(t + 1) = \left(  x^{(0)}(1) - \dfrac{b}{a} \right)e^{-at} + \dfrac{b}{a} = -30929e^{-0.0023t} + 31000
$$
*  求生成数列值$${\hat{x}}^{(1)}(k+1)$$及模型的还原值$${\hat{x}}^{(0)}(k+1)$$
$$
{\hat{x}}^{(0)} = (71.1,72.4,72.2,72.1,71.9,71.7,71.6)
$$
###### 第三步：模型检验
|年份|原始值|还原值|残差|相对误差|
|---|---|---|---|---|
|1986|71.1|71.1|0|0|
|1987|72.4|72.4|-0.0057|0.01%|
|1988|72.4|72.2|0.1638|0.23%|
|1989|72.1|72.1|0.0329|0.05%|
|1990|71.4|71.9|-0.4984|0.7%|
|1991|72.0|71.7|0.2699|0.37%|
|1992|71.6|71.6|0.0378|0.05%|
经验证，该模型的精度较高，可进行预测和预报。

#### 灰色模型
* GM(1,1)模型
* GM(1,n)模型		方程有一阶，有n个变量
* GM(n,k)模型
* 该模型使用的不是原始数据的序列，而是生成的数据序列。核心是对原始数据作累加生成（或其他处理生成）得到近似的指数规律再进行建模的方法。
* 在处理较少的特征值数据，不需要数据的样本空间足够大，就能解决历史数据少、序列的完整性以及可靠性低的问题，能将无规律的原始数据进行生成得到规律较强的生成序列。
* 适用于中短期的预测，适合近似于指数增长的预测。

### 时间序列预测
#### 时间序列分析方法概述
常见的确定性时间序列模型有以下几种类型：
* 加法模型
$$
y_t = T_t + S_t + C_t + R_t
$$
* 乘法模型
$$
y_t = T_t * S_t * C_t * R_t
$$
* 混合模型
$$
\begin{aligned}
y_t & = T_t * S_t + R_t \\
y_t & = S_t + T_t * C_t * R_t \\
\end{aligned}
$$
#### 移动平均法
移动平均法是根据时间序列资料逐渐推移，依次计算包含一定项数的时序平均数， 以反映长期趋势的方法。当时间序列的数值由于受周期变动和不规则变动的影响，起伏较大，不易显示出发展趋势时，可用移动平均法，消除这些因素的影响，分析、预测序列的长期趋势。

移动平均法有简单移动平均法，加权移动平均法，趋势移动平均法等。 
##### 简单移动平均法
设观测序列为 $$ y_1,y_2,...,y_T$$，取移动平均的项数 $$N<T$$。一次简单移动平均值计算公式为：
$$
M^{(1)}_t = \dfrac{1}{N}(y_t + y_{t-1} + ... + y_{t-N+1})
$$
当预测目标的基本趋势是在某一水平上下波动时，可用一次简单移动平均方法建立预测模型：
$$
{\hat{y}}_{t+1} = M^{(t)}_t = \dfrac{1}{N}(\hat{y}_t + \hat{y}_{t-1} + ... + \hat{y}_{t-N+1})
$$
其预测误差为：
$$
S = \sqrt{\dfrac{ \sum _ {t = N + 1}^{T}(\hat{y}_t - y_t)^2}{T - N}}
$$
近N 期序列值的平均值作为未来各期的预测结果。一般 N 取值范围：$$ 5 \leq N \leq 200$$。当历史序列的基本趋势变化不大且序列中随机变动成分较多时，N 的 取值应较大一些。否则 N 的取值应小一些。在有确定的季节变动周期的资料中，移动平均的项数应取周期长度。
**选择佳 N 值的一个有效方法是，比较若干模型的预测误差。预测标准误差小者为好。**
简单移动平均法只适合做**近期预测**，而且是预测目标的发展趋势变化不大的情况。 如果目标的发展趋势存在其它的变化，采用简单移动平均法就会产生**较大的预测偏差和滞后**。

##### 加权移动平均法
简单移动平均法中，每项数据在求平均时地位是等同的，但是，每项数据所包含的信息量不一样，近期数据对未来影响更大，应考虑各期数据的重要性，对近期数据给予较大的权重。
加权移动平均公式为：
$$
M_t = \dfrac{w_1y_t + w_2y_{t - 1} + ... + w_Ny_{t - N + 1}}{w_1 + w_2 + ... + w_N} , t \geq N
$$
式中 $$M_t$$ 为 $$t$$ 期加权移动平均数；$$w_i$$ 为 $$y_{t - i + 1}$$ 的权数，它体现了相应的 $$ y_t $$ 在加权平均数中的重要性。
利用加权移动平均数来做预测，其预测公式为
$$
\hat{y}_{t+1} = M_t
$$
即以第 $$t $$ 期加权移动平均数作为第 $$t+1$$ 期的预测值。

###### 预测值的修正

当还原值与实际值有普遍偏差时，可以进行修正。通过计算总的平均相对误差，对预测值做修正。

#### 指数平滑法

一般说来历史数据对未来值的影响是随时间间隔的增长而递减的。所以，切合实际的方法应是对各期观测值**依时间顺序进行加权平均**作为预测值。指数平滑法可满足这一要求，而且具有简单的递推形式。 

指数平滑法根据平滑次数的不同，又分为一次指数平滑

法、二次指数平滑法和三次指数平滑法。

##### 一次指数平滑法

###### 预测模型

$$ \alpha $$ 为加权系数，$$ 0 < \alpha < 1$$，一次指数平滑公式为：
$$
S_t^{(1)} = \alpha y_t +(1 - \alpha)S_{t -1}^{(1)}
$$
将该公式一次展开，有
$$
S_t^{(1)} = \alpha y_t +(1 - \alpha)[\alpha y_{t - 1} + (1 - \alpha)S_{t - 2}^{(1)}] = ... = \alpha \sum_{j = 0}^{\infty}(1 - \alpha)^j y_{t - j}
$$
该式表明 $$S_t^{(1)}$$ 是全部历史数据的加权平均，加权系数分别为 $$ \alpha,\alpha (1 - \alpha),\alpha (1 - \alpha)^2,... $$ 显然有
$$
\sum_{j = 0}^{\infty}\alpha (1 - \alpha)^j = \dfrac{\alpha}{1 - (1 - \alpha)} = 1
$$
由于加权系数符合指数规律，又具有平滑数据的功能，故称为指数平滑。  

以这种平滑值进行预测，就是一次指数平滑法。预测模型为 
$$
\hat{y}_{t + 1} = S_{t}^{(1)} = \alpha y_t + (1 - \alpha )\hat{y}_t
$$
也就是以第 $$t$$ 期指数平滑值作为 $$t+1$$ 期预测值。

###### 加权系数的选择

$$\alpha$$ 的大小规定了在新预测值中新数据与原预测值所占的比重。$$\alpha$$ 值越大，新数据所占的比重就愈大，原预测值所占的比重就愈小，反之亦然。

$$\alpha$$ 值应根据时间序列 的具体性质在 0～1 之间选择。具体如何选择一般可遵循下列原则：

* 如果时间序列波动不大，比较平稳，则 $$\alpha$$ 应取小一点，如（0.1～0.5）。以减少修正幅度，使预测模型 能包含较长时间序列的信息；
* 如果时间序列具有迅速且明显的变动倾向，则 $$\alpha$$ 应取大一点，如（0.6～0.8）。使预测模型灵敏度高一些，以便迅速跟上数据的变化。  

实际上，可以多取几个 $$\alpha$$ 值进行计算，看哪个预测误差小，就采用哪个。

######  初始值的确定

初始值是由预测者估计或指定的。当时间序列的数据较多，比如在 20 个以上时，初始值对以后的预测值影响很少，可选用第一期数据为初始值。如果时间序列的数据较少，在 20 个以下时，初始值对以后的预测值影响很大，这时，就必须认真研究如何正确确定初始值。一般以初几期实际值的平均值作为初始值。

##### 二次指数平滑

一次指数平滑法虽然克服了移动平均法的缺点。但当时间序列的变动出现直线趋势时，用一次指数平滑法进行预测，仍存在明显的滞后偏差。因此，也必须加以修正。 修正的方法与趋势移动平均法相同，即再作二次指数平滑，利用滞后偏差的规律建立直线趋势模型。其计算公式：
$$
\begin{aligned}
S_{t}^{(1)} &= \alpha y_t + (1 - \alpha)S_{t - 1}^{(1)}\\
S_{t}^{(2)} &= \alpha S_{t}^{(1)} + (1 - \alpha)S_{t - 1}^{(2)}
\end{aligned}
$$

$$S_{t}^{(1)} $$ 为一次指数的平滑值；$$S_{t}^{(2)}$$ 为二次指数的平滑值。可用直线趋势模型
$$
\hat{y}_{t+T} = a_t + b_tT , T = 1,2,...\\
\left\{
\begin{aligned}
a_t & = 2S_t^{(1)} - S_t^{(2)}\\
b_t & = \dfrac{\alpha}{1 - \alpha}(S_t^{(1)} - S_t^{(2)})\\
\end{aligned}
\right.
$$
###### 例子：预测发电总量
如下表为我国1965-1985年的发电总量，试用二次指数平滑法预测1986年和1987年的发电总量
| 年份 | t    | 发电总量 $$y_t$$ | 一次平滑值 | 二次平滑值 | $$  y_{t + 1} $$ 的估计值 |
| ---- | ---- | ---------------- | ---------- | ---------- | ------------------------- |
|1965|1|676|676|676| |
|1966|2|825|720.7|689.4|676|
|1967|3|774|736.7|703.6|765.4|
|1968|4|716|730.5|711.7|784.0|
|1969|5|940|793.3|736.2|757.4|
|1970|6|1159|903.0|786.2|875.0|
|1971|7|1384|1047.3|864.6|1069.9|
|1972|8|1524|1190.3|962.3|1308.4|
|1973|9|1668|1333.6|1073.7|1516.1|
|1974|10|1688|1439.9|1183.6|1705.0|
|1975|11|1958|1595.4|1307.1|1806.1|
|1976|12|2031|1726.1|1432.8|2007.2|
|1977|13|2234|1878.4|1366.5|2145.0|
|1978|14|2566|2084.7|1722.0|2324.1|
|1979|15|2820|2305.3|1897.0|2602.9|
|1980|16|3006|2515.5|2082.5|2888.6|
|1981|17|3093|2688.8|2264.4|3134.1|
|1982|18|3277|2865.2|2444.6|3295.0|
|1983|19|3514|3059.9|2629.2|3466.1|
|1984|20|3770|3272.9|2822.3|3675.1|
|1985|21|4107|3523.1|3032.6|3916.6|

取 $$\alpha = 0.3$$，初始值 $$ S^{(1)}_0 $$ 和 $$ S^{(2)}_0 $$ 都取序列的首项数值，即 $$S_0^{(1)} = S_0^{(2)} = 676 $$。计算 $$S^{(1)}_t$$，$$S^{(2)}_t$$ 得到：
$$
S_{21}^{(1)}=3523.1,S_{21}^{(2)} = 3032.6
$$
代入公式求解 $$a_{21}，b_{21}$$ 得到
$$
\begin{aligned}
a_{21} & = 2S_{21}^{(1)} - S_{21}^{(2)} = 4013.7 \\
b_{21} & = \dfrac{\alpha}{1 - \alpha}(S_{21}^{(1)} - S_{21}^{(2)}) = 210.24\\
\end{aligned}
$$
于是，得到 $$t = 21$$ 时的直线趋势方程为
$$
\hat{y}_{21 + T} = 4013.7 + 210.24T
$$
预测1986年和1987的发电总量为（单位：亿度）
$$
\begin{aligned}
\hat{y}_{1986} = \hat{y}_{22} = \hat{y}_{21 + 1} = 4223.95\\
\hat{y}_{1987} = \hat{y}_{23} = \hat{y}_{21 + 2} = 4434.19\\
\end{aligned}
$$
为了求各期的模拟值，可将 $$T = 1$$ 代入直线趋势模型，得到
$$
\hat{y}_{t + 1} = (2S_t^{(1)} - S_t^{(2)}) + \dfrac{\alpha }{1 - \alpha}(S_t^{(1)} - S_t^{(2)})
$$
令 $$t = 1,2,...,21$$ ，由上式求出各期的模拟值。

##### 三次指数平滑法
当时间序列的变动表现为二次曲线趋势时，则需要用三次指数平滑法。三次指数平滑是在而辞职书平滑的基础上，再进行一次平滑，计算公式为
$$
\left\{
\begin{aligned}
S_{t}^{(1)} &= \alpha y_t + (1 - \alpha)S_{t - 1}^{(1)}\\
S_{t}^{(2)} &= \alpha S_{t}^{(1)} + (1 - \alpha)S_{t - 1}^{(2)}\\
S_{t}^{(3)} &= \alpha S_{t}^{(2)} + (1 - \alpha)S_{t - 1}^{(3)}\\
\end{aligned}
\right.
$$
三次指数平滑法的预测模型为
$$
\hat{y}_{t+T} = a_t + b_tT + c_tT^2, T = 1,2,...
$$
其中：
$$
\left\{
\begin{aligned}
a_t & = 3S_t^{(1)} - 3S_t^{(2)} + S_t^{(3)} \\
b_t & = \dfrac{\alpha}{2(1 - \alpha)^2}[(6 - 5\alpha)S_t^{(1)} - 2(5 - 4\alpha)S_t^{(2)} + (4 - 3\alpha)S_t^{(3)}]\\
c_t & = \dfrac{{\alpha}^2}{2(1 - \alpha)^2}[S_t^{(1)} - 2S_t^{(2)} + S_t^{(3)}]
\end{aligned}
\right.
$$
###### 参数的选择
一般取 $$\alpha$$ 在0.1-0.3为宜，值越大意味着采用的数据越少。如果序列基本趋势平稳，参数值应取小一些，以减少修正幅度。如果预测目标的趋势已发生系统的变化，值应取得大一些，这样对数据信息进行大幅度修正。

### 作业

#### 1.灰色模型预测长江水质
|年份|1995|1996|1997|1998|1999|
| ----| ----| ----| ----| ----| ----|
|排放量/亿吨|174|179|183|189|207|
|年份|2000|2001|2002|2003|2004|
|排放量/亿吨|234|220.5|256|270|285|

**（尝试使用Matlab编程）**

#### 2.年平均降雨量
某地区年平均降雨量数据如表所示

|年份|1|2|3|4|5|6|
|---|---|---|---|---|---|---|
|降雨量|390.6|412|323|559.2|380.8|542.4|
|年份|7|8|9|10|11|12|
|降雨量|553|310|561|300|632|540|
|年份|13|14|15|16|17| |
|降雨量|406.2|313.8|576|587.6|318.5| |

规定$$ \xi  = 320 $$，并认为$$ x^{(0)}(i) \leq \xi $$为旱灾，预测下一次旱灾发生的时间。

**模型任选。**
